/**
 * tty.js - an xterm emulator
 * Christopher Jeffrey (https://github.com/chjj/tty.js)
 *
 * Originally forked from (with the author's permission):
 *
 * Fabrice Bellard's javascript vt100 for jslinux:
 * http://bellard.org/jslinux/
 * Copyright (c) 2011 Fabrice Bellard
 * (Redistribution or commercial use is prohibited
 *  without the author's permission.)
 *
 * The original design remains. The terminal itself
 * has been extended to include xterm CSI codes, among
 * other features.
*/(function(){function j(a,b,c){this.cols=a,this.rows=b,c&&(this.handler=c),this.ybase=0,this.ydisp=0,this.x=0,this.y=0,this.cursorState=0,this.cursorHidden=!1,this.convertEol=!1,this.state=0,this.queue="",this.scrollTop=0,this.scrollBottom=this.rows-1,this.applicationKeypad=!1,this.originMode=!1,this.insertMode=!1,this.wraparoundMode=!1,this.charset=null,this.normal=null,this.decLocator,this.x10Mouse,this.vt200Mouse,this.vt300Mouse,this.normalMouse,this.mouseEvents,this.sendFocus,this.utfMouse,this.sgrMouse,this.urxvtMouse,this.element,this.children,this.refreshStart,this.refreshEnd,this.savedX,this.savedY,this.savedCols,this.defAttr=131840,this.curAttr=this.defAttr,this.params=[],this.currentParam=0,this.prefix="",this.postfix="",this.lines=[];var d=this.rows;while(d--)this.lines.push(this.blankLine());this.tabs,this.setupStops()}function l(a,b,c,d){a.addEventListener(b,c,d||!1)}function m(a,b,c,d){a.removeEventListener(b,c,d||!1)}function n(a){return a.preventDefault&&a.preventDefault(),a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,!1}function p(){var a=b.createElement("span");a.innerHTML="hello world",b.body.appendChild(a);var c=a.scrollWidth;a.style.fontWeight="bold";var d=a.scrollWidth;return b.body.removeChild(a),c!==d}"use strict";var a=this,b=this.document,c=0,d=1,e=2,f=3,g=4,h=5,i=6;j.colors=["#2e3436","#cc0000","#4e9a06","#c4a000","#3465a4","#75507b","#06989a","#d3d7cf","#555753","#ef2929","#8ae234","#fce94f","#729fcf","#ad7fa8","#34e2e2","#eeeeec"],j.colors=function(){function d(b,c,d){a.push("#"+e(b)+e(c)+e(d))}function e(a){return a=a.toString(16),a.length<2?"0"+a:a}var a=j.colors,b=[0,95,135,175,215,255],c;c=0;for(;c<216;c++)d(b[c/36%6|0],b[c/6%6|0],b[c%6]);c=0;for(;c<24;c++)b=8+c*10,d(b,b,b);return a}(),j.defaultColors={bg:"#000000",fg:"#f0f0f0"},j.colors[256]=j.defaultColors.bg,j.colors[257]=j.defaultColors.fg,j.termName="xterm",j.geometry=[80,30],j.cursorBlink=!0,j.visualBell=!1,j.popOnBell=!1,j.scrollback=1e3,j.screenKeys=!1,j.programFeatures=!1,j.debug=!1,j.focus=null,j.prototype.focus=function(){if(j.focus===this)return;j.focus&&(j.focus.cursorState=0,j.focus.refresh(j.focus.y,j.focus.y),j.focus.sendFocus&&j.focus.send("[O")),j.focus=this,this.sendFocus&&this.send("[I"),this.showCursor()},j.bindKeys=function(){if(j.focus)return;l(b,"keydown",function(a){return j.focus.keyDown(a)},!0),l(b,"keypress",function(a){return j.focus.keyPress(a)},!0)},j.prototype.open=function(){var a=this,c=0,d;this.element=b.createElement("div"),this.element.className="terminal",this.children=[];for(;c<this.rows;c++)d=b.createElement("div"),this.element.appendChild(d),this.children.push(d);return this.refresh(0,this.rows-1),this.focus(),j.brokenBold==null&&(j.brokenBold=p()),this.element},j.prototype.bindMouse=function(){function g(a){var b,c;b=k(a),c=o(a);if(!c)return;j(b,c);switch(a.type){case"mousedown":e=b;break;case"mouseup":e=32;break;case f:}}function h(a){var b=e,c;c=o(a);if(!c)return;b+=32,j(b,c)}function i(a,b){if(!d.utfMouse){if(b===255)return a.push(0);b>127&&(b=127),a.push(b)}else{if(b===2047)return a.push(0);b<127?a.push(b):(b>2047&&(b=2047),a.push(192|b>>6),a.push(128|b&63))}}function j(a,b){if(d.vt300Mouse){a&=3,b.x-=32,b.y-=32;var c="[24";if(a===0)c+="1";else if(a===1)c+="3";else if(a===2)c+="5";else{if(a===3)return;c+="0"}c+="~["+b.x+","+b.y+"]\r",d.send(c);return}if(d.decLocator){a&=3,b.x-=32,b.y-=32,a===0?a=2:a===1?a=4:a===2?a=6:a===3&&(a=3),d.send("["+a+";"+(a===3?4:0)+";"+b.y+";"+b.x+";"+(b.page||0)+"&w");return}if(d.urxvtMouse){b.x-=32,b.y-=32,b.x++,b.y++,d.send("["+a+";"+b.x+";"+b.y+"M");return}if(d.sgrMouse){b.x-=32,b.y-=32,d.send("[<"+((a&3)===3?a&-4:a)+";"+b.x+";"+b.y+((a&3)===3?"m":"M"));return}var c=[];i(c,a),i(c,b.x),i(c,b.y),d.send("[M"+q.fromCharCode.apply(q,c))}function k(a){var b,c,e,f,g;switch(a.type){case"mousedown":b=a.button!=null?+a.button:a.which!=null?a.which-1:null,~navigator.userAgent.indexOf("MSIE")&&(b=b===1?0:b===4?1:b);break;case"mouseup":b=3;break;case"DOMMouseScroll":b=a.detail<0?64:65;break;case"mousewheel":b=a.wheelDeltaY>0?64:65}return c=a.shiftKey?4:0,e=a.metaKey?8:0,f=a.ctrlKey?16:0,g=c|e|f,d.vt200Mouse?g&=f:d.normalMouse||(g=0),b=32+(g<<2)+b,b}function o(a){var c,e,g,h,i;if(a.pageX==null)return;c=a.pageX,e=a.pageY,i=d.element;while(i!==b.documentElement)c-=i.offsetLeft,e-=i.offsetTop,i=i.parentNode;return g=d.element.clientWidth,h=d.element.clientHeight,c=c/g*d.cols|0,e=e/h*d.rows|0,c<0&&(c=0),c>d.cols&&(c=d.cols),e<0&&(e=0),e>d.rows&&(e=d.rows),c+=32,e+=32,{x:c,y:e,down:a.type==="mousedown",up:a.type==="mouseup",wheel:a.type===f,move:a.type==="mousemove"}}var c=this.element,d=this,e=32,f="onmousewheel"in a?"mousewheel":"DOMMouseScroll";l(c,"mousedown",function(a){if(!d.mouseEvents)return;return g(a),d.focus(),d.vt200Mouse?(g({"__proto__":a,type:"mouseup"}),n(a)):(d.normalMouse&&l(b,"mousemove",h),d.x10Mouse||l(b,"mouseup",function c(a){return g(a),d.normalMouse&&m(b,"mousemove",h),m(b,"mouseup",c),n(a)}),n(a))}),l(c,f,function(a){if(!d.mouseEvents)return;if(d.x10Mouse||d.vt300Mouse||d.decLocator)return;return g(a),n(a)}),l(c,f,function(a){if(d.mouseEvents)return;if(d.applicationKeypad)return;return a.type==="DOMMouseScroll"?d.scrollDisp(a.detail<0?-5:5):d.scrollDisp(a.wheelDeltaY>0?-5:5),n(a)})},j.prototype.refresh=function(a,b){var c,d,e,f,g,h,i,k,l,m,n,o,p,q,r;b-a>=this.rows/2&&(r=this.element.parentNode,r&&r.removeChild(this.element)),i=this.cols,d=a;for(;d<=b;d++){q=d+this.ydisp,f=this.lines[q],g="",d===this.y&&this.cursorState&&this.ydisp===this.ybase&&!this.cursorHidden?c=this.x:c=-1,l=this.defAttr,e=0;for(;e<i;e++){k=f[e][0],h=f[e][1],e===c&&(k=-1),k!==l&&(l!==this.defAttr&&(g+="</span>"),k!==this.defAttr&&(k===-1?g+='<span class="reverse-video">':(o=[],n=k&511,m=k>>9&511,p=k>>18,p&1&&(j.brokenBold||o.push("tty_b"),m<8&&(m+=8)),p&2&&o.push("tty_u"),n!==256&&o.push("tty_bg"+n),m!==257&&o.push("tty_fg"+m),g+='<span class="'+o.join(" ")+'">')));switch(h){case"&":g+="&amp;";break;case"<":g+="&lt;";break;case">":g+="&gt;";break;default:h<=" "?g+="&nbsp;":g+=h}l=k}l!==this.defAttr&&(g+="</span>"),this.children[d].innerHTML=g}r&&r.appendChild(this.element)},j.prototype.cursorBlink=function(){if(j.focus!==this)return;this.cursorState^=1,this.refresh(this.y,this.y)},j.prototype.showCursor=function(){this.cursorState||(this.cursorState=1,this.refresh(this.y,this.y))},j.prototype.startBlink=function(){if(!j.cursorBlink)return;var a=this;this._blinker=function(){a.cursorBlink()},a.cursorState=0,a.cursorBlink(),this._blink=s(this._blinker,500)},j.prototype.refreshBlink=function(){if(!j.cursorBlink)return;clearInterval(this._blink),this._blink=s(this._blinker,500)},j.prototype.stopBlink=function(){if(!j.cursorBlink)return;clearInterval(this._blink),this.cursorState=0,this.refresh(this.y,this.y)},j.prototype.scroll=function(){var a;++this.ybase===j.scrollback&&(this.ybase=this.ybase/2|0,this.lines=this.lines.slice(-(this.ybase+this.rows)+1)),this.ydisp=this.ybase,a=this.ybase+this.rows-1,a-=this.rows-1-this.scrollBottom,a===this.lines.length?this.lines.push(this.blankLine()):this.lines.splice(a,0,this.blankLine()),this.scrollTop!==0&&(this.ybase!==0&&(this.ybase--,this.ydisp=this.ybase),this.lines.splice(this.ybase+this.scrollTop,1)),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},j.prototype.scrollDisp=function(a){this.ydisp+=a,this.ydisp>this.ybase?this.ydisp=this.ybase:this.ydisp<0&&(this.ydisp=0),this.refresh(0,this.rows-1)},j.prototype.write=function(a){var b=a.length,j=0,l;this.refreshStart=this.y,this.refreshEnd=this.y,this.ybase!==this.ydisp&&(this.ydisp=this.ybase,this.maxRange());for(;j<b;j++){l=a[j];switch(this.state){case c:switch(l){case"":this.bell();break;case"\n":case"":case"\f":this.convertEol&&(this.x=0),this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll());break;case"\r":this.x=0;break;case"\b":this.x>0&&this.x--;break;case"	":this.x=this.nextStop();break;case"":this.state=d;break;default:l>=" "&&(this.charset&&this.charset[l]&&(l=this.charset[l]),this.x>=this.cols&&(this.x=0,this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll())),this.lines[this.y+this.ybase][this.x]=[this.curAttr,l],this.x++,this.updateRange(this.y))}break;case d:switch(l){case"[":this.params=[],this.currentParam=0,this.state=e;break;case"]":this.params=[],this.currentParam=0,this.state=f;break;case"P":this.params=[],this.currentParam=0,this.state=h;break;case"_":this.state=i;break;case"^":this.state=i;break;case"c":this.reset();break;case"E":this.x=0;case"D":this.index();break;case"M":this.reverseIndex();break;case"%":this.charset=null,this.state=c,j++;break;case"(":case")":case"*":case"+":case"-":case".":this.state=g;break;case"/":this.charset=null,this.state=c,j++;break;case"7":this.saveCursor(),this.state=c;break;case"8":this.restoreCursor(),this.state=c;break;case"#":this.state=c,j++;break;case"H":this.tabSet();break;case"=":this.log("Serial port requested application keypad."),this.applicationKeypad=!0,this.state=c;break;case">":this.log("Switching back to normal keypad."),this.applicationKeypad=!1,this.state=c;break;default:this.state=c,this.error("Unknown ESC control: %s.",l)}break;case g:switch(l){case"0":this.charset=k;break;case"B":default:this.charset=null}this.state=c;break;case f:if(l===""||l===""){l===""&&j++,this.params.push(this.currentParam);switch(this.params[0]){case 0:case 1:case 2:this.params[1]&&this.handleTitle(this.params[1]);break;case 3:break;case 4:case 5:break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:break;case 46:break;case 50:break;case 51:break;case 52:break;case 104:case 105:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:}this.params=[],this.currentParam=0,this.state=c}else this.params.length?this.currentParam+=l:l>="0"&&l<="9"?this.currentParam=this.currentParam*10+l.charCodeAt(0)-48:l===";"&&(this.params.push(this.currentParam),this.currentParam="");break;case e:if(l==="?"||l===">"||l==="!"){this.prefix=l;break}if(l>="0"&&l<="9"){this.currentParam=this.currentParam*10+l.charCodeAt(0)-48;break}if(l==="$"||l==='"'||l===" "||l==="'"){this.postfix=l;break}this.params.push(this.currentParam),this.currentParam=0;if(l===";")break;this.state=c;switch(l){case"A":this.cursorUp(this.params);break;case"B":this.cursorDown(this.params);break;case"C":this.cursorForward(this.params);break;case"D":this.cursorBackward(this.params);break;case"H":this.cursorPos(this.params);break;case"J":this.eraseInDisplay(this.params);break;case"K":this.eraseInLine(this.params);break;case"m":this.charAttributes(this.params);break;case"n":this.deviceStatus(this.params);break;case"@":this.insertChars(this.params);break;case"E":this.cursorNextLine(this.params);break;case"F":this.cursorPrecedingLine(this.params);break;case"G":this.cursorCharAbsolute(this.params);break;case"L":this.insertLines(this.params);break;case"M":this.deleteLines(this.params);break;case"P":this.deleteChars(this.params);break;case"X":this.eraseChars(this.params);break;case"`":this.charPosAbsolute(this.params);break;case"a":this.HPositionRelative(this.params);break;case"c":this.sendDeviceAttributes(this.params);break;case"d":this.linePosAbsolute(this.params);break;case"e":this.VPositionRelative(this.params);break;case"f":this.HVPosition(this.params);break;case"h":this.setMode(this.params);break;case"l":this.resetMode(this.params);break;case"r":this.setScrollRegion(this.params);break;case"s":this.saveCursor(this.params);break;case"u":this.restoreCursor(this.params);break;case"I":this.cursorForwardTab(this.params);break;case"S":this.scrollUp(this.params);break;case"T":this.params.length<2&&!this.prefix&&this.scrollDown(this.params);break;case"Z":this.cursorBackwardTab(this.params);break;case"b":this.repeatPrecedingCharacter(this.params);break;case"g":this.tabClear(this.params);break;case"p":switch(this.prefix){case"!":this.softReset(this.params)}break;default:this.error("Unknown CSI code: %s.",l)}this.prefix="",this.postfix="";break;case h:if(l===""||l===""){l===""&&j++;switch(this.prefix){case"":break;case"$q":var m=this.currentParam,n=!1;switch(m){case'"q':m='0"q';break;case'"p':m='61"p';break;case"r":m=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r";break;case"m":m="0m";break;default:this.error("Unknown DCS Pt: %s.",m),m=""}this.send("P"+ +n+"$r"+m+"\\");break;case"+p":break;case"+q":var m=this.currentParam,n=!1;this.send("P"+ +n+"+r"+m+"\\");break;default:this.error("Unknown DCS prefix: %s.",this.prefix)}this.currentParam=0,this.prefix="",this.state=c}else this.currentParam?this.currentParam+=l:!this.prefix&&l!=="$"&&l!=="+"?this.currentParam=l:this.prefix.length===2?this.currentParam=l:this.prefix+=l;break;case i:if(l===""||l==="")l===""&&j++,this.state=c}}this.updateRange(this.y),this.refresh(this.refreshStart,this.refreshEnd)},j.prototype.writeln=function(a){this.write(a+"\r\n")},j.prototype.keyDown=function(a){var b;switch(a.keyCode){case 8:if(a.shiftKey){b="\b";break}b="";break;case 9:if(a.shiftKey){b="[Z";break}b="	";break;case 13:b="\r";break;case 27:b="";break;case 37:if(this.applicationKeypad){b="OD";break}b="[D";break;case 39:if(this.applicationKeypad){b="OC";break}b="[C";break;case 38:if(this.applicationKeypad){b="OA";break}if(a.ctrlKey)return this.scrollDisp(-1),n(a);b="[A";break;case 40:if(this.applicationKeypad){b="OB";break}if(a.ctrlKey)return this.scrollDisp(1),n(a);b="[B";break;case 46:b="[3~";break;case 45:b="[2~";break;case 36:if(this.applicationKeypad){b="OH";break}b="OH";break;case 35:if(this.applicationKeypad){b="OF";break}b="OF";break;case 33:if(a.shiftKey)return this.scrollDisp(-(this.rows-1)),n(a);b="[5~";break;case 34:if(a.shiftKey)return this.scrollDisp(this.rows-1),n(a);b="[6~";break;case 112:b="OP";break;case 113:b="OQ";break;case 114:b="OR";break;case 115:b="OS";break;case 116:b="[15~";break;case 117:b="[17~";break;case 118:b="[18~";break;case 119:b="[19~";break;case 120:b="[20~";break;case 121:b="[21~";break;case 122:b="[23~";break;case 123:b="[24~";break;default:if(a.ctrlKey)a.keyCode>=65&&a.keyCode<=90?b=q.fromCharCode(a.keyCode-64):a.keyCode===32?b=q.fromCharCode(0):a.keyCode>=51&&a.keyCode<=55?b=q.fromCharCode(a.keyCode-51+27):a.keyCode===56?b=q.fromCharCode(127):a.keyCode===219?b=q.fromCharCode(27):a.keyCode===221&&(b=q.fromCharCode(29));else if(!o&&a.altKey||o&&a.metaKey)a.keyCode>=65&&a.keyCode<=90?b=""+q.fromCharCode(a.keyCode+32):a.keyCode>=48&&a.keyCode<=57&&(b=""+(a.keyCode-48))}return b?(this.showCursor(),this.handler(b),n(a)):!0},j.prototype.keyPress=function(a){var b;n(a);if(a.charCode)b=a.charCode;else if(a.which==null)b=a.keyCode;else{if(a.which===0||a.charCode===0)return!1;b=a.which}return!b||a.ctrlKey||a.altKey||a.metaKey?!1:(b=q.fromCharCode(b),this.showCursor(),this.handler(b),!1)},j.prototype.send=function(a){var b=this;this.queue||r(function(){b.handler(b.queue),b.queue=""},1),this.queue+=a},j.prototype.bell=function(){if(!j.visualBell)return;var a=this;this.element.style.borderColor="white",r(function(){a.element.style.borderColor=""},10),j.popOnBell&&this.focus()},j.prototype.log=function(){if(!j.debug)return;if(!a.console||!a.console.log)return;var b=Array.prototype.slice.call(arguments);a.console.log.apply(a.console,b)},j.prototype.error=function(){if(!j.debug)return;if(!a.console||!a.console.error)return;var b=Array.prototype.slice.call(arguments);a.console.error.apply(a.console,b)},j.prototype.resize=function(a,c){var d,e,f,g,h;a<1&&(a=1),c<1&&(c=1),g=this.cols;if(g<a){h=[this.defAttr," "],f=this.lines.length;while(f--)while(this.lines[f].length<a)this.lines[f].push(h)}else if(g>a){f=this.lines.length;while(f--)while(this.lines[f].length>a)this.lines[f].pop()}this.setupStops(g),this.cols=a,g=this.rows;if(g<c){e=this.element;while(g++<c)this.lines.length<c+this.ybase&&this.lines.push(this.blankLine()),this.children.length<c&&(d=b.createElement("div"),e.appendChild(d),this.children.push(d))}else if(g>c)while(g-->c){this.lines.length>c+this.ybase&&this.lines.pop();if(this.children.length>c){e=this.children.pop();if(!e)continue;e.parentNode.removeChild(e)}}this.rows=c,this.y>=c&&(this.y=c-1),this.x>=a&&(this.x=a-1),this.scrollTop=0,this.scrollBottom=c-1,this.refresh(0,this.rows-1),this.normal=null},j.prototype.updateRange=function(a){a<this.refreshStart&&(this.refreshStart=a),a>this.refreshEnd&&(this.refreshEnd=a)},j.prototype.maxRange=function(){this.refreshStart=0,this.refreshEnd=this.rows-1},j.prototype.setupStops=function(a){a!=null?this.tabs[a]||(a=this.prevStop(a)):(this.tabs={},a=0);for(;a<this.cols;a+=8)this.tabs[a]=!0},j.prototype.prevStop=function(a){a==null&&(a=this.x);while(!this.tabs[--a]&&a>0);return a>=this.cols?this.cols-1:a<0?0:a},j.prototype.nextStop=function(a){a==null&&(a=this.x);while(!this.tabs[++a]&&a<this.cols);return a>=this.cols?this.cols-1:a<0?0:a},j.prototype.eraseRight=function(a,b){var c=this.lines[this.ybase+b],d=[this.curAttr," "];for(;a<this.cols;a++)c[a]=d;this.updateRange(b)},j.prototype.eraseLeft=function(a,b){var c=this.lines[this.ybase+b],d=[this.curAttr," "];a++;while(a--)c[a]=d;this.updateRange(b)},j.prototype.eraseLine=function(a){this.eraseRight(0,a)},j.prototype.blankLine=function(a){var b=a?this.curAttr:this.defAttr,c=[b," "],d=[],e=0;for(;e<this.cols;e++)d[e]=c;return d},j.prototype.ch=function(a){return a?[this.curAttr," "]:[this.defAttr," "]},j.prototype.is=function(a){var b=this.termName||j.termName;return(b+"").indexOf(a)===0},j.prototype.handler=function(){},j.prototype.handleTitle=function(){},j.prototype.index=function(){this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll()),this.state=c},j.prototype.reverseIndex=function(){var a;this.y--,this.y<this.scrollTop&&(this.y++,this.lines.splice(this.y+this.ybase,0,this.blankLine(!0)),a=this.rows-1-this.scrollBottom,this.lines.splice(this.rows-1+this.ybase-a+1,1),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)),this.state=c},j.prototype.reset=function(){j.call(this,this.cols,this.rows),this.refresh(0,this.rows-1)},j.prototype.tabSet=function(){this.tabs[this.x]=!0,this.state=c},j.prototype.cursorUp=function(a){var b=a[0];b<1&&(b=1),this.y-=b,this.y<0&&(this.y=0)},j.prototype.cursorDown=function(a){var b=a[0];b<1&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1)},j.prototype.cursorForward=function(a){var b=a[0];b<1&&(b=1),this.x+=b,this.x>=this.cols&&(this.x=this.cols-1)},j.prototype.cursorBackward=function(a){var b=a[0];b<1&&(b=1),this.x-=b,this.x<0&&(this.x=0)},j.prototype.cursorPos=function(a){var b,c;b=a[0]-1,a.length>=2?c=a[1]-1:c=0,b<0?b=0:b>=this.rows&&(b=this.rows-1),c<0?c=0:c>=this.cols&&(c=this.cols-1),this.x=c,this.y=b},j.prototype.eraseInDisplay=function(a){var b;switch(a[0]){case 0:this.eraseRight(this.x,this.y),b=this.y+1;for(;b<this.rows;b++)this.eraseLine(b);break;case 1:this.eraseLeft(this.x,this.y),b=this.y;while(b--)this.eraseLine(b);break;case 2:b=this.rows;while(b--)this.eraseLine(b);break;case 3:}},j.prototype.eraseInLine=function(a){switch(a[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);break;case 2:this.eraseLine(this.y)}},j.prototype.charAttributes=function(a){var b=a.length,c=0,d,e,f;for(;c<b;c++){f=a[c];if(f>=30&&f<=37)this.curAttr=this.curAttr&-261633|f-30<<9;else if(f>=40&&f<=47)this.curAttr=this.curAttr&-512|f-40;else if(f>=90&&f<=97)f+=8,this.curAttr=this.curAttr&-261633|f-90<<9;else if(f>=100&&f<=107)f+=8,this.curAttr=this.curAttr&-512|f-100;else if(f===0)this.curAttr=this.defAttr;else if(f===1)this.curAttr=this.curAttr|1<<18;else if(f===4)this.curAttr=this.curAttr|2<<18;else if(f===7||f===27){if(f===7){if(this.curAttr>>18&4)continue;this.curAttr=this.curAttr|4<<18}else if(f===27){if(~(this.curAttr>>18)&4)continue;this.curAttr=this.curAttr&-1048577}d=this.curAttr&511,e=this.curAttr>>9&511,this.curAttr=this.curAttr&-262144|(d<<9|e)}else if(f===22)this.curAttr=this.curAttr&-262145;else if(f===24)this.curAttr=this.curAttr&-524289;else if(f===39)this.curAttr=this.curAttr&-261633,this.curAttr=this.curAttr|(this.defAttr>>9&511)<<9;else if(f===49)this.curAttr=this.curAttr&-512,this.curAttr=this.curAttr|this.defAttr&511;else if(f===38){if(a[c+1]!==5)continue;c+=2,f=a[c]&255,this.curAttr=this.curAttr&-261633|f<<9}else if(f===48){if(a[c+1]!==5)continue;c+=2,f=a[c]&255,this.curAttr=this.curAttr&-512|f}}},j.prototype.deviceStatus=function(a){if(!this.prefix)switch(a[0]){case 5:this.send("[0n");break;case 6:this.send("["+(this.y+1)+";"+(this.x+1)+"R")}else if(this.prefix==="?")switch(a[0]){case 6:this.send("[?"+(this.y+1)+";"+(this.x+1)+"R");break;case 15:break;case 25:break;case 26:break;case 53:}},j.prototype.insertChars=function(a){var b,c,d,e;b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=this.x,e=[this.curAttr," "];while(b--&&d<this.cols)this.lines[c].splice(d++,0,e),this.lines[c].pop()},j.prototype.cursorNextLine=function(a){var b=a[0];b<1&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1),this.x=0},j.prototype.cursorPrecedingLine=function(a){var b=a[0];b<1&&(b=1),this.y-=b,this.y<0&&(this.y=0),this.x=0},j.prototype.cursorCharAbsolute=function(a){var b=a[0];b<1&&(b=1),this.x=b-1},j.prototype.insertLines=function(a){var b,c,d;b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=this.rows-1-this.scrollBottom,d=this.rows-1+this.ybase-d+1;while(b--)this.lines.splice(c,0,this.blankLine(!0)),this.lines.splice(d,1);this.updateRange(this.y),this.updateRange(this.scrollBottom)},j.prototype.deleteLines=function(a){var b,c,d;b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=this.rows-1-this.scrollBottom,d=this.rows-1+this.ybase-d;while(b--)this.lines.splice(d+1,0,this.blankLine(!0)),this.lines.splice(c,1);this.updateRange(this.y),this.updateRange(this.scrollBottom)},j.prototype.deleteChars=function(a){var b,c,d;b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=[this.curAttr," "];while(b--)this.lines[c].splice(this.x,1),this.lines[c].push(d)},j.prototype.eraseChars=function(a){var b,c,d,e;b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=this.x,e=[this.curAttr," "];while(b--&&d<this.cols)this.lines[c][d++]=e},j.prototype.charPosAbsolute=function(a){var b=a[0];b<1&&(b=1),this.x=b-1,this.x>=this.cols&&(this.x=this.cols-1)},j.prototype.HPositionRelative=function(a){var b=a[0];b<1&&(b=1),this.x+=b,this.x>=this.cols&&(this.x=this.cols-1)},j.prototype.sendDeviceAttributes=function(a){if(a[0]>0)return;this.prefix?this.prefix===">"&&(this.is("xterm")?this.send("[>0;276;0c"):this.is("rxvt-unicode")?this.send("[>85;95;0c"):this.is("linux")?this.send(a[0]+"c"):this.is("screen")&&this.send("[>83;40003;0c")):this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")?this.send("[?1;2c"):this.is("linux")&&this.send("[?6c")},j.prototype.linePosAbsolute=function(a){var b=a[0];b<1&&(b=1),this.y=b-1,this.y>=this.rows&&(this.y=this.rows-1)},j.prototype.VPositionRelative=function(a){var b=a[0];b<1&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1)},j.prototype.HVPosition=function(a){a[0]<1&&(a[0]=1),a[1]<1&&(a[1]=1),this.y=a[0]-1,this.y>=this.rows&&(this.y=this.rows-1),this.x=a[1]-1,this.x>=this.cols&&(this.x=this.cols-1)},j.prototype.setMode=function(a){if(typeof a=="object"){var b=a.length,c=0;for(;c<b;c++)this.setMode(a[c]);return}if(!this.prefix)switch(a){case 4:this.insertMode=!0;break;case 20:}else if(this.prefix==="?")switch(a){case 1:this.applicationKeypad=!0;break;case 3:this.savedCols=this.cols,this.resize(132,this.rows);break;case 6:this.originMode=!0;break;case 7:this.wraparoundMode=!0;break;case 12:break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=a===9,this.vt200Mouse=a===1e3,this.normalMouse=a>1e3,this.mouseEvents=!0,this.element.style.cursor="default",this.log("Binding to mouse events.");break;case 1004:this.sendFocus=!0;break;case 1005:this.utfMouse=!0;break;case 1006:this.sgrMouse=!0;break;case 1015:this.urxvtMouse=!0;break;case 25:this.cursorHidden=!1;break;case 1049:case 47:case 1047:if(!this.normal){var d={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs};this.reset(),this.normal=d,this.showCursor()}}},j.prototype.resetMode=function(a){if(typeof a=="object"){var b=a.length,c=0;for(;c<b;c++)this.resetMode(a[c]);return}if(!this.prefix)switch(a){case 4:this.insertMode=!1;break;case 20:}else if(this.prefix==="?")switch(a){case 1:this.applicationKeypad=!1;break;case 3:this.cols===132&&this.savedCols&&this.resize(this.savedCols,this.rows),delete this.savedCols;break;case 6:this.originMode=!1;break;case 7:this.wraparoundMode=!1;break;case 12:break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=!1,this.vt200Mouse=!1,this.normalMouse=!1,this.mouseEvents=!1,this.element.style.cursor="";break;case 1004:this.sendFocus=!1;break;case 1005:this.utfMouse=!1;break;case 1006:this.sgrMouse=!1;break;case 1015:this.urxvtMouse=!1;break;case 25:this.cursorHidden=!0;break;case 1049:case 47:case 1047:this.normal&&(this.lines=this.normal.lines,this.ybase=this.normal.ybase,this.ydisp=this.normal.ydisp,this.x=this.normal.x,this.y=this.normal.y,this.scrollTop=this.normal.scrollTop,this.scrollBottom=this.normal.scrollBottom,this.tabs=this.normal.tabs,this.normal=null,this.refresh(0,this.rows-1),this.showCursor())}},j.prototype.setScrollRegion=function(a){if(this.prefix)return;this.scrollTop=(a[0]||1)-1,this.scrollBottom=(a[1]||this.rows)-1,this.x=0,this.y=0},j.prototype.saveCursor=function(a){this.savedX=this.x,this.savedY=this.y},j.prototype.restoreCursor=function(a){this.x=this.savedX||0,this.y=this.savedY||0},j.prototype.cursorForwardTab=function(a){var b=a[0]||1;while(b--)this.x=this.nextStop()},j.prototype.scrollUp=function(a){var b=a[0]||1;while(b--)this.lines.splice(this.ybase+this.scrollTop,1),this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine());this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},j.prototype.scrollDown=function(a){var b=a[0]||1;while(b--)this.lines.splice(this.ybase+this.scrollBottom,1),this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine());this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},j.prototype.initMouseTracking=function(a){},j.prototype.resetTitleModes=function(a){},j.prototype.cursorBackwardTab=function(a){var b=a[0]||1;while(b--)this.x=this.prevStop()},j.prototype.repeatPrecedingCharacter=function(a){var b=a[0]||1,c=this.lines[this.ybase+this.y],d=c[this.x-1]||[this.defAttr," "];while(b--)c[this.x++]=d},j.prototype.tabClear=function(a){var b=a[0];b<=0?delete this.tabs[this.x]:b===3&&(this.tabs={})},j.prototype.mediaCopy=function(a){},j.prototype.setResources=function(a){},j.prototype.disableModifiers=function(a){},j.prototype.setPointerMode=function(a){},j.prototype.softReset=function(a){this.cursorHidden=!1,this.insertMode=!1,this.originMode=!1,this.wraparoundMode=!1,this.applicationKeypad=!1,this.scrollTop=0,this.scrollBottom=this.rows-1,this.curAttr=this.defAttr,this.x=this.y=0,this.charset=null},j.prototype.requestAnsiMode=function(a){},j.prototype.requestPrivateMode=function(a){},j.prototype.setConformanceLevel=function(a){},j.prototype.loadLEDs=function(a){},j.prototype.setCursorStyle=function(a){},j.prototype.setCharProtectionAttr=function(a){},j.prototype.restorePrivateValues=function(a){},j.prototype.setAttrInRectangle=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g,h;for(;b<d+1;b++){g=this.lines[this.ybase+b];for(h=c;h<e;h++)g[h]=[f,g[h][1]]}this.updateRange(a[0]),this.updateRange(a[2])},j.prototype.savePrivateValues=function(a){},j.prototype.manipulateWindow=function(a){},j.prototype.reverseAttrInRectangle=function(a){},j.prototype.setTitleModeFeature=function(a){},j.prototype.setWarningBellVolume=function(a){},j.prototype.setMarginBellVolume=function(a){},j.prototype.copyRectangle=function(a){},j.prototype.enableFilterRectangle=function(a){},j.prototype.requestParameters=function(a){},j.prototype.selectChangeExtent=function(a){},j.prototype.fillRectangle=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g,h;for(;c<e+1;c++){g=this.lines[this.ybase+c];for(h=d;h<f;h++)g[h]=[g[h][0],q.fromCharCode(b)]}this.updateRange(a[1]),this.updateRange(a[3])},j.prototype.enableLocatorReporting=function(a){var b=a[0]>0},j.prototype.eraseRectangle=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f,g,h;h=[this.curAttr," "];for(;b<d+1;b++){f=this.lines[this.ybase+b];for(g=c;g<e;g++)f[g]=h}this.updateRange(a[0]),this.updateRange(a[2])},j.prototype.setLocatorEvents=function(a){},j.prototype.selectiveEraseRectangle=function(a){},j.prototype.requestLocatorPosition=function(a){},j.prototype.insertColumns=function(){var a=params[0],b=this.ybase+this.rows,c=[this.curAttr," "],d;while(a--)for(d=this.ybase;d<b;d++)this.lines[d].splice(this.x+1,0,c),this.lines[d].pop();this.maxRange()},j.prototype.deleteColumns=function(){var a=params[0],b=this.ybase+this.rows,c=[this.curAttr," "],d;while(a--)for(d=this.ybase;d<b;d++)this.lines[d].splice(this.x,1),this.lines[d].push(c);this.maxRange()};var k={"`":"◆",a:"▒",b:"	",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},o=~navigator.userAgent.indexOf("Mac"),q=this.String,r=this.setTimeout,s=this.setInterval;typeof module!="undefined"?module.exports=j:this.Terminal=j}).call(function(){return this||(typeof window!="undefined"?window:global)}());